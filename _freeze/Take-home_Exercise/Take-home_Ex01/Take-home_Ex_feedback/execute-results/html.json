{
  "hash": "0c058bcb5d4e52631ee0a98aed3ae5af",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home_Ex_feedback\"\nauthor: \"Xu Xnyi\"\nformat: html \neditor: visual\ndate-modified: \"last-modified\"\nexecute: \n       echo: true \n       eval: true \n       warning: false \n       freeze: true\n---\n\n\n\n# Selecting the work from\n[Ng Jin Yao](https://isss608-blessmebellburve.netlify.app/take-home_ex/take-home_ex01/take-home_ex01)\n\n# Three good design principles:\n\n1.  Clear obijective and data processing: Data wrangling ensures accuracy and relevance in your visualizations. Addtionally, from the starter, stating out the data we are going to analyze which can make more sense for later visualization.\n\n-   Duplicates using distinct()\n\n-   Data types (e.g., converting Age from chr to dbl)\n\n-   New features like Age_group and Region using mutate() and case_when()\n\n-   Joining with geographic metadata using left_join() after transforming the PA column\n\n2.  Visual diversity:There are three different visualization types tailored to the data's characteristics.\n\n-   A population pyramid to illustrate age-sex structure (a demographic standard)\n\n-   A bar chart comparing regions by population and sex composition\n\n-   A half-eye + boxplot to examine age distribution patterns by region\n\n3.  More concise labels in the data visualization: In the Population Pyramid Plot Visualisation, \"Female/Male\" is right above the graph which make the visualization more concise. There is no need to put the \"gender\" legend again.\n\n# Three areas for further improvement:\n\n1.  In this take-home exercise, it is not necessary to use geospatial method to do visualization or data-processing.\n\n2.  Reproducibility and Code Commenting Issue: While your narrative is strong, some code logic is missing or only described in words. Without it, others can’t reproduce the visuals.\n\n3.  Half-eye + Box Plot Visualisation of Age vs Region needs to change to more readable version and be straightforward.\n\n# Make-over version of data visualization-Half-eye + Box Plot Visualisation of Age vs Region\n\n**Ridgeline plot with inside plot and annotations**: it conveys the ridgeline plot is a type of chart that displays the distribution of a numeric variable for several groups.\n\n# Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, ggplot2, ggrepel, patchwork, \n               ggthemes,dplyr, xml2, sf, scales) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsgResData24 <- read_csv(\"respopagesex2024.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndistinct(sgResData24)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 60,424 × 6\n   PA         SZ                     Age   Sex       Pop  Time\n   <chr>      <chr>                  <chr> <chr>   <dbl> <dbl>\n 1 Ang Mo Kio Ang Mo Kio Town Centre 0     Males      10  2024\n 2 Ang Mo Kio Ang Mo Kio Town Centre 0     Females    10  2024\n 3 Ang Mo Kio Ang Mo Kio Town Centre 1     Males      10  2024\n 4 Ang Mo Kio Ang Mo Kio Town Centre 1     Females    10  2024\n 5 Ang Mo Kio Ang Mo Kio Town Centre 2     Males      10  2024\n 6 Ang Mo Kio Ang Mo Kio Town Centre 2     Females    10  2024\n 7 Ang Mo Kio Ang Mo Kio Town Centre 3     Males      10  2024\n 8 Ang Mo Kio Ang Mo Kio Town Centre 3     Females    10  2024\n 9 Ang Mo Kio Ang Mo Kio Town Centre 4     Males      30  2024\n10 Ang Mo Kio Ang Mo Kio Town Centre 4     Females    10  2024\n# ℹ 60,414 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsgResData24 <- sgResData24 %>%\n  mutate(\n    # Convert age to numeric, handle \"90_and_Over\"\n    Age_num = case_when(\n      Age == \"90_and_Over\" ~ 90,\n      TRUE ~ suppressWarnings(as.numeric(Age))  # Avoid warnings from \"90_and_Over\"\n    ),\n    \n    # Group into age bands\n    Age_group = case_when(\n      Age_num >= 0 & Age_num <= 9   ~ \"0-9\",\n      Age_num >= 10 & Age_num <= 19 ~ \"10-19\",\n      Age_num >= 20 & Age_num <= 29 ~ \"20-29\",\n      Age_num >= 30 & Age_num <= 39 ~ \"30-39\",\n      Age_num >= 40 & Age_num <= 49 ~ \"40-49\",\n      Age_num >= 50 & Age_num <= 59 ~ \"50-59\",\n      Age_num >= 60 & Age_num <= 69 ~ \"60-69\",\n      Age_num >= 70 & Age_num <= 79 ~ \"70-79\",\n      Age_num >= 80 & Age_num <= 89 ~ \"80-89\",\n      Age_num >= 90                ~ \"90+\",\n      TRUE                         ~ NA_character_\n    )\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the GeoJSON file\ngeo_data <- st_read(\"MasterPlan2019PlanningAreaBoundaryNoSea.geojson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `MasterPlan2019PlanningAreaBoundaryNoSea' from data source \n  `C:\\xinyi-ux\\ISSS608-VAA\\Take-home_Exercise\\Take-home_Ex01\\MasterPlan2019PlanningAreaBoundaryNoSea.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 55 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to parse HTML and extract PLN_AREA_N and REGION_N\nextract_info <- function(html_str) {\n  doc <- read_html(html_str)\n  rows <- xml_find_all(doc, \".//tr\")\n\n  # Loop through rows and extract key-value pairs\n  data <- lapply(rows, function(row) {\n    th <- xml_text(xml_find_first(row, \".//th\"))\n    td <- xml_text(xml_find_first(row, \".//td\"))\n    if (!is.na(th) && !is.na(td)) {\n      return(setNames(list(td), th))\n    } else {\n      return(NULL)\n    }\n  })\n\n  # Combine and extract specific fields\n  info <- do.call(c, data)\n  list(\n    Town = info[[\"PLN_AREA_N\"]],\n    Region = info[[\"REGION_N\"]]\n  )\n}\n\n\n# Apply the extraction function to each row\ninfo_list <- lapply(geo_data$Description, extract_info)\n\n# Combine results into a data frame\ninfo_df <- bind_rows(info_list) %>% distinct() %>% arrange(Region, Town)\n\n# View result\nprint(info_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 55 × 2\n   Town          Region        \n   <chr>         <chr>         \n 1 BISHAN        CENTRAL REGION\n 2 BUKIT MERAH   CENTRAL REGION\n 3 BUKIT TIMAH   CENTRAL REGION\n 4 DOWNTOWN CORE CENTRAL REGION\n 5 GEYLANG       CENTRAL REGION\n 6 KALLANG       CENTRAL REGION\n 7 MARINA EAST   CENTRAL REGION\n 8 MARINA SOUTH  CENTRAL REGION\n 9 MARINE PARADE CENTRAL REGION\n10 MUSEUM        CENTRAL REGION\n# ℹ 45 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsgResData24 %>% mutate(PA = toupper(PA))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 60,424 × 8\n   PA         SZ                     Age   Sex       Pop  Time Age_num Age_group\n   <chr>      <chr>                  <chr> <chr>   <dbl> <dbl>   <dbl> <chr>    \n 1 ANG MO KIO Ang Mo Kio Town Centre 0     Males      10  2024       0 0-9      \n 2 ANG MO KIO Ang Mo Kio Town Centre 0     Females    10  2024       0 0-9      \n 3 ANG MO KIO Ang Mo Kio Town Centre 1     Males      10  2024       1 0-9      \n 4 ANG MO KIO Ang Mo Kio Town Centre 1     Females    10  2024       1 0-9      \n 5 ANG MO KIO Ang Mo Kio Town Centre 2     Males      10  2024       2 0-9      \n 6 ANG MO KIO Ang Mo Kio Town Centre 2     Females    10  2024       2 0-9      \n 7 ANG MO KIO Ang Mo Kio Town Centre 3     Males      10  2024       3 0-9      \n 8 ANG MO KIO Ang Mo Kio Town Centre 3     Females    10  2024       3 0-9      \n 9 ANG MO KIO Ang Mo Kio Town Centre 4     Males      30  2024       4 0-9      \n10 ANG MO KIO Ang Mo Kio Town Centre 4     Females    10  2024       4 0-9      \n# ℹ 60,414 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n# Rename Town to PA in the region info dataframe\nregion_info <- info_df %>% rename(PA = Town)\n\n# left join sgResData24 with region_info to get Region column\nsgResData24 <- sgResData24 %>% mutate(PA = toupper(PA)) %>%\n  left_join(region_info, by = \"PA\")\n\nprint(sgResData24)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 60,424 × 9\n   PA         SZ                Age   Sex     Pop  Time Age_num Age_group Region\n   <chr>      <chr>             <chr> <chr> <dbl> <dbl>   <dbl> <chr>     <chr> \n 1 ANG MO KIO Ang Mo Kio Town … 0     Males    10  2024       0 0-9       NORTH…\n 2 ANG MO KIO Ang Mo Kio Town … 0     Fema…    10  2024       0 0-9       NORTH…\n 3 ANG MO KIO Ang Mo Kio Town … 1     Males    10  2024       1 0-9       NORTH…\n 4 ANG MO KIO Ang Mo Kio Town … 1     Fema…    10  2024       1 0-9       NORTH…\n 5 ANG MO KIO Ang Mo Kio Town … 2     Males    10  2024       2 0-9       NORTH…\n 6 ANG MO KIO Ang Mo Kio Town … 2     Fema…    10  2024       2 0-9       NORTH…\n 7 ANG MO KIO Ang Mo Kio Town … 3     Males    10  2024       3 0-9       NORTH…\n 8 ANG MO KIO Ang Mo Kio Town … 3     Fema…    10  2024       3 0-9       NORTH…\n 9 ANG MO KIO Ang Mo Kio Town … 4     Males    30  2024       4 0-9       NORTH…\n10 ANG MO KIO Ang Mo Kio Town … 4     Fema…    10  2024       4 0-9       NORTH…\n# ℹ 60,414 more rows\n```\n\n\n:::\n:::\n\n\n\n[Ridgeline plot](https://data-to-viz.com/graph/ridgeline.html): Used to show distribution across groups.\n\n**stat_halfeye()** is used for density plots\n\n**stat_summary()** for showing medians\n\n**annotate()** adds static text annotations\n\n**scale()** functions customize scales and colors, including a manual color scale using MetBrewer::met.brewer()\n\n**coord_flip()** flips the axes to change the plot orientation\n\n-   **Legend Construction (`p_legend`)**\n\n    -   We use a subset of data (`rent_title_words`) filtered for the word *beautiful*\n\n    -   And `geom_curve` to draw arrows pointing to specific elements\n\n-   **Inserting the Legend into the Main Plot**\n\n    -   The `inset_element` function combines the main plot (`p`) and the legend (`p_legend`) by embedding the legend within the main plot’s space\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(sgResData24)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 9\n$ PA        <chr> \"ANG MO KIO\", \"ANG MO KIO\", \"ANG MO KIO\", \"ANG MO KIO\", \"ANG…\n$ SZ        <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo …\n$ Age       <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", …\n$ Sex       <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", …\n$ Pop       <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, …\n$ Time      <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, …\n$ Age_num   <dbl> 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, …\n$ Age_group <chr> \"0-9\", \"0-9\", \"0-9\", \"0-9\", \"0-9\", \"0-9\", \"0-9\", \"0-9\", \"0-9…\n$ Region    <chr> \"NORTH-EAST REGION\", \"NORTH-EAST REGION\", \"NORTH-EAST REGION…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggdist)\nlibrary(ggtext)\nlibrary(extrafont) \nfont_import()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nImporting fonts may take a few minutes, depending on the number of fonts and the speed of the system.\nContinue? [y/n] \n```\n\n\n:::\n\n```{.r .cell-code}\n# Compute weighted mean for each region\nmean_age <- sgResData24 %>%\n  group_by(Region) %>%\n  summarise(weighted_mean = weighted.mean(Age_num, Pop, na.rm = TRUE))\n\n# Theme and background setup\nbg_color <- \"grey97\"\nfont_family <- \"Fira Sans\"\n\nplot_subtitle <- glue::glue(\"Age distribution by Singapore regions in 2024.\\nRed diamonds show the population-weighted mean age.\")\n\n# Main plot\np <- ggplot(sgResData24, aes(x = Region, y = Age_num, weight = Pop)) +\n  stat_halfeye(fill_type = \"segments\", alpha = 0.3) +\n  stat_interval() +\n  stat_summary(geom = \"point\", fun = median, color = \"black\") +\n  geom_point(data = mean_age, aes(x = Region, y = weighted_mean), \n             color = \"red\", size = 3, shape = 18, inherit.aes = FALSE) +\n  scale_x_discrete(labels = stringr::str_to_title) +\n  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 10)) +\n  coord_flip() +\n  labs(\n    title = toupper(\"AGE DISTRIBUTION BY REGION\"),\n    subtitle = plot_subtitle,\n    caption = \"Data: Singapore Department of Statistics, 2024\",\n    x = NULL,\n    y = \"Age\"\n  ) +\n  theme_minimal(base_family = font_family) +\n  theme(\n    plot.background = element_rect(color = NA, fill = bg_color),\n    panel.grid = element_blank(),\n    panel.grid.major.x = element_line(linewidth = 0.1, color = \"grey75\"),\n    plot.title = element_text(family = \"Serif\"),\n    plot.subtitle = ggtext::element_textbox_simple(margin = margin(t = 4, b = 16), size = 10),\n    plot.caption = ggtext::element_textbox_simple(margin = margin(t = 12), size = 8),\n    axis.text.y = element_text(hjust = 0, margin = margin(r = -10), family = \"Serif\"),\n    plot.margin = margin(4, 4, 4, 4)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex_feedback_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n-   **Central Region** has the **oldest average age**.\n\n-   **West and North-East Regions** have younger populations on average.\n\n-   The **spread** (width of intervals) is relatively similar, showing a broad mix of age groups in all regions.\n",
    "supporting": [
      "Take-home_Ex_feedback_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}